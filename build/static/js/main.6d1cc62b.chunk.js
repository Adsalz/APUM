(this["webpackJsonpplanning-medecins"]=this["webpackJsonpplanning-medecins"]||[]).push([[0],{41:function(e,t,r){},68:function(e,t,r){"use strict";r.r(t);var s=r(2),n=r.n(s),a=r(32),i=r.n(a),c=(r(41),r(8)),o=r(5),l=r(33),d=r(3),u=r(17);const j=Object(l.a)({apiKey:"AIzaSyDesXYDyPsrG5HxkkPbj9XuqFQV91j2ixY",authDomain:"apum-8cfa4.firebaseapp.com",databaseURL:"https://apum-8cfa4-default-rtdb.europe-west1.firebasedatabase.app",projectId:"apum-8cfa4",storageBucket:"apum-8cfa4.appspot.com",messagingSenderId:"965430779165",appId:"1:965430779165:web:2b1d142cc5937744d5d5f4"}),b=Object(d.h)(j),h=Object(u.b)(j),O="users",p=async e=>{try{const t=await Object(d.f)(Object(d.e)(b,O,e));return t.exists()?(console.log("Utilisateur trouv\xe9:",t.data()),{id:t.id,...t.data()}):(console.log("Aucun utilisateur trouv\xe9 avec cet UID"),null)}catch(t){throw console.error("Erreur lors de la r\xe9cup\xe9ration de l'utilisateur:",t),t}},m=async()=>{try{const e=h.currentUser;if(!e)throw new Error("Utilisateur non authentifi\xe9");if(!(await Object(d.f)(Object(d.e)(b,O,e.uid))).exists())throw new Error("Utilisateur non trouv\xe9");return(await Object(d.g)(Object(d.c)(b,O))).docs.map((e=>({id:e.id,...e.data()})))}catch(e){throw console.error("Erreur lors de la r\xe9cup\xe9ration de tous les utilisateurs:",e),e}},x=async()=>{try{await Object(u.d)(h),console.log("Utilisateur d\xe9connect\xe9")}catch(e){throw console.error("Erreur lors de la d\xe9connexion:",e),e}};var v=r(0);var g=function(){const[e,t]=Object(s.useState)(""),[r,n]=Object(s.useState)(""),[a,i]=Object(s.useState)(""),c=Object(o.f)();return Object(v.jsxs)("div",{className:"login-container",children:[Object(v.jsx)("h2",{children:"Connexion"}),Object(v.jsxs)("form",{onSubmit:async t=>{t.preventDefault(),i("");try{console.log("Tentative de connexion avec:",e);const t=await(async(e,t)=>{try{const r=await Object(u.c)(h,e,t);console.log("Utilisateur connect\xe9:",r);const s=await p(r.user.uid);return{...r,role:s.role}}catch(a){throw console.error("Erreur lors de la connexion:",a),a}})(e,r);if(console.log("R\xe9sultat de loginUser:",t),!t||!t.user)throw new Error("\xc9chec de l'authentification");console.log("Connexion r\xe9ussie, r\xe9cup\xe9ration des informations utilisateur");const s=await p(t.user.uid);if(console.log("Informations utilisateur r\xe9cup\xe9r\xe9es:",s),!s)throw new Error("Utilisateur non trouv\xe9 dans Firestore");console.log("R\xf4le de l'utilisateur:",s.role),"medecin"===s.role?(console.log("Redirection vers le tableau de bord m\xe9decin"),c.push("/dashboard-medecin")):"admin"===s.role?(console.log("Redirection vers le tableau de bord admin"),c.push("/dashboard-admin")):(console.log("R\xf4le non reconnu:",s.role),i("R\xf4le utilisateur non reconnu"))}catch(a){console.error("Erreur de connexion:",a),i("Identifiants incorrects ou erreur de connexion: "+a.message)}},children:[Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"email",children:"Email :"}),Object(v.jsx)("input",{type:"email",id:"email",value:e,onChange:e=>t(e.target.value),required:!0})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"password",children:"Mot de passe :"}),Object(v.jsx)("input",{type:"password",id:"password",value:r,onChange:e=>n(e.target.value),required:!0})]}),a&&Object(v.jsx)("p",{className:"error",children:a}),Object(v.jsx)("button",{type:"submit",children:"Se connecter"})]})]})};const f="desiderata",D="planning",w="periode_saisie",y=e=>{if(e instanceof d.a)return e;const t=new Date(e);return d.a.fromDate(t)},S=e=>e instanceof d.a?e.toDate().toISOString():"string"===typeof e?e:(console.error("Format de date non reconnu:",e),null),E=async(e,t)=>{try{const r=Object(d.c)(b,f),s=Object(d.k)(r),n=await Object(d.g)(s),a=Object(d.o)(b);n.forEach((r=>{const s=r.data();N(s,e,t)&&a.delete(r.ref)})),await a.commit(),console.log("Desiderata obsol\xe8tes supprim\xe9s")}catch(r){throw console.error("Erreur lors de la suppression des desiderata obsol\xe8tes:",r),r}},N=(e,t,r)=>{const s=e.startDate.toDate(),n=e.endDate.toDate(),a=new Date(t),i=new Date(r);return n<a||s>i},R=async()=>{try{const e=await Object(d.f)(Object(d.e)(b,D,w));if(e.exists()){const t=e.data();return{startDate:S(t.startDate),endDate:S(t.endDate)}}return null}catch(e){throw console.error("Erreur lors de la r\xe9cup\xe9ration de la p\xe9riode de saisie:",e),e}},T=async e=>{try{if(!h.currentUser)throw new Error("Utilisateur non authentifi\xe9");const t=Object(d.k)(Object(d.c)(b,f),Object(d.n)("userId","==",e));return(await Object(d.g)(t)).docs.map((e=>{const t=e.data();return{id:e.id,...t,startDate:S(t.startDate),endDate:S(t.endDate)}}))}catch(t){throw console.error("Erreur lors de la r\xe9cup\xe9ration des desiderata:",t),t}},U=async(e,t)=>{try{if(!h.currentUser)throw new Error("Utilisateur non authentifi\xe9");const r=y(e),s=y(t),n=Object(d.k)(Object(d.c)(b,f),Object(d.n)("startDate","<=",s),Object(d.n)("endDate",">=",r));return(await Object(d.g)(n)).docs.map((e=>{const t=e.data();return{id:e.id,userId:t.userId,startDate:S(t.startDate),endDate:S(t.endDate),desiderata:t.desiderata,nombreGardesSouhaitees:t.nombreGardesSouhaitees,gardesGroupees:t.gardesGroupees,renfortsAssocies:t.renfortsAssocies}}))}catch(r){throw console.error("Erreur lors de la r\xe9cup\xe9ration des desiderata pour la p\xe9riode:",r),r}},A=async(e,t)=>{try{if(!h.currentUser)throw new Error("Utilisateur non authentifi\xe9");const r=Object(d.e)(b,D,e);await Object(d.m)(r,{...t,startDate:y(t.startDate),endDate:y(t.endDate)})}catch(r){throw console.error("Erreur lors de la mise \xe0 jour du planning:",r),r}},C=async()=>{try{if(!h.currentUser)throw new Error("Utilisateur non authentifi\xe9");const e=Object(d.k)(Object(d.c)(b,D),Object(d.n)("publishedAt","!=",null),Object(d.j)("publishedAt","desc"),Object(d.i)(1)),t=await Object(d.g)(e);if(t.empty)return null;const r=t.docs[0],s=r.data();return{id:r.id,...s,startDate:S(s.startDate),endDate:S(s.endDate),publishedAt:S(s.publishedAt)}}catch(e){throw console.error("Erreur lors de la r\xe9cup\xe9ration du planning publi\xe9:",e),e}};var k=function(){const[e,t]=Object(s.useState)(""),[r,n]=Object(s.useState)(""),[a,i]=Object(s.useState)(""),[c,o]=Object(s.useState)(""),[l,d]=Object(s.useState)("");return Object(v.jsxs)("div",{className:"change-password-container",children:[Object(v.jsx)("h2",{children:"Changer le mot de passe"}),c&&Object(v.jsx)("p",{className:"error",children:c}),l&&Object(v.jsx)("p",{className:"success",children:l}),Object(v.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),o(""),d(""),r===a)try{await(async e=>{try{const t=h.currentUser;if(!t)throw new Error("Aucun utilisateur connect\xe9");await Object(u.e)(t,e),console.log("Mot de passe mis \xe0 jour avec succ\xe8s")}catch(c){throw console.error("Erreur lors de la mise \xe0 jour du mot de passe:",c),c}})(r),d("Mot de passe mis \xe0 jour avec succ\xe8s."),t(""),n(""),i("")}catch(c){o("Erreur lors de la mise \xe0 jour du mot de passe: "+c.message)}else o("Les nouveaux mots de passe ne correspondent pas.")},children:[Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"currentPassword",children:"Mot de passe actuel:"}),Object(v.jsx)("input",{type:"password",id:"currentPassword",value:e,onChange:e=>t(e.target.value),required:!0})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"newPassword",children:"Nouveau mot de passe:"}),Object(v.jsx)("input",{type:"password",id:"newPassword",value:r,onChange:e=>n(e.target.value),required:!0})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"confirmPassword",children:"Confirmer le nouveau mot de passe:"}),Object(v.jsx)("input",{type:"password",id:"confirmPassword",value:a,onChange:e=>i(e.target.value),required:!0})]}),Object(v.jsx)("button",{type:"submit",children:"Changer le mot de passe"})]})]})};var F=function(){const[e,t]=Object(s.useState)(null),[r,n]=Object(s.useState)([]),[a,i]=Object(s.useState)(!0),[l,d]=Object(s.useState)(null),[u,j]=Object(s.useState)(!1),b=Object(o.f)();return Object(s.useEffect)((()=>{const e=h.onAuthStateChanged((async e=>{if(e)try{console.log("Utilisateur authentifi\xe9:",e);const s=await p(e.uid);if(console.log("Donn\xe9es utilisateur r\xe9cup\xe9r\xe9es:",s),s&&"medecin"===s.role){t(s);try{const e=await T(s.id);n(e)}catch(r){console.error("Erreur lors de la r\xe9cup\xe9ration des desiderata:",r)}}else d("Utilisateur non autoris\xe9 ou donn\xe9es manquantes"),b.push("/")}catch(l){console.error("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es:",l),d("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es: "+l.message)}else t(null),n([]),b.push("/");i(!1)}));return()=>e()}),[b]),a?Object(v.jsx)("div",{children:"Chargement..."}):l?Object(v.jsxs)("div",{children:["Erreur: ",l]}):e?Object(v.jsxs)("div",{className:"dashboard-container",children:[Object(v.jsx)("h1",{children:"Tableau de bord M\xe9decin"}),Object(v.jsx)("nav",{children:Object(v.jsxs)("ul",{children:[Object(v.jsx)("li",{children:Object(v.jsx)(c.b,{to:"/formulaire-desirata",children:"Saisir des desiderata"})}),Object(v.jsx)("li",{children:Object(v.jsx)(c.b,{to:"/visualisation-planning",children:"Visualiser le planning"})}),Object(v.jsx)("li",{children:Object(v.jsx)("button",{onClick:()=>j(!u),children:u?"Masquer":"Modifier le mot de passe"})})]})}),Object(v.jsxs)("div",{className:"dashboard-content",children:[Object(v.jsxs)("h2",{children:["Bienvenue, Dr. ",e.nom]}),Object(v.jsx)("p",{children:"Ici, vous pouvez acc\xe9der \xe0 vos fonctionnalit\xe9s principales :"}),Object(v.jsxs)("ul",{children:[Object(v.jsx)("li",{children:"Saisir vos desiderata pour les prochaines p\xe9riodes"}),Object(v.jsx)("li",{children:"Visualiser le planning actuel"}),Object(v.jsx)("li",{children:"Modifier votre mot de passe"})]}),r.length>0&&Object(v.jsxs)("div",{children:[Object(v.jsx)("h3",{children:"Vos derniers desiderata :"}),Object(v.jsx)("ul",{children:r.map(((e,t)=>Object(v.jsxs)("li",{children:["Pour la p\xe9riode du ",new Date(e.startDate).toLocaleDateString()," au ",new Date(e.endDate).toLocaleDateString()]},t)))})]}),u&&Object(v.jsx)(k,{})]}),Object(v.jsx)("button",{onClick:async()=>{try{await x(),b.push("/")}catch(l){console.error("Erreur lors de la d\xe9connexion:",l),d("Erreur lors de la d\xe9connexion: "+l.message)}},children:"Se d\xe9connecter"})]}):Object(v.jsx)("div",{children:"Utilisateur non trouv\xe9"})};var G=function(){const[e,t]=Object(s.useState)(null),[r,n]=Object(s.useState)(!0),[a,i]=Object(s.useState)(null),[l,d]=Object(s.useState)(!1),u=Object(o.f)();return Object(s.useEffect)((()=>{const e=h.onAuthStateChanged((async e=>{if(e)try{const r=await p(e.uid);r&&"admin"===r.role?t(r):(i("Utilisateur non autoris\xe9 ou donn\xe9es manquantes"),u.push("/"))}catch(a){console.error("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es:",a),i("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es: "+a.message)}else t(null),u.push("/");n(!1)}));return()=>e()}),[u]),r?Object(v.jsx)("div",{children:"Chargement..."}):a?Object(v.jsxs)("div",{children:["Erreur: ",a]}):e?Object(v.jsxs)("div",{className:"dashboard-container",children:[Object(v.jsx)("h1",{children:"Tableau de bord Administrateur"}),Object(v.jsx)("nav",{children:Object(v.jsxs)("ul",{children:[Object(v.jsx)("li",{children:Object(v.jsx)(c.b,{to:"/gestion-utilisateurs",children:"Gestion des utilisateurs"})}),Object(v.jsx)("li",{children:Object(v.jsx)(c.b,{to:"/gestion-planning-admin",children:"Gestion du planning"})}),Object(v.jsx)("li",{children:Object(v.jsx)(c.b,{to:"/gestion-periode-saisie",children:"Gestion de la p\xe9riode de saisie"})}),Object(v.jsx)("li",{children:Object(v.jsx)("button",{onClick:()=>d(!l),children:l?"Masquer":"Modifier le mot de passe"})})]})}),Object(v.jsxs)("div",{className:"dashboard-content",children:[Object(v.jsxs)("h2",{children:["Bienvenue, ",e.prenom," ",e.nom]}),Object(v.jsx)("p",{children:"Ici, vous pouvez acc\xe9der \xe0 vos fonctionnalit\xe9s principales :"}),Object(v.jsxs)("ul",{children:[Object(v.jsx)("li",{children:"G\xe9rer les utilisateurs"}),Object(v.jsx)("li",{children:"G\xe9rer le planning"}),Object(v.jsx)("li",{children:"D\xe9finir la p\xe9riode de saisie des desiderata"}),Object(v.jsx)("li",{children:"Modifier votre mot de passe"})]}),l&&Object(v.jsx)(k,{})]}),Object(v.jsx)("button",{onClick:async()=>{try{await x(),u.push("/")}catch(a){console.error("Erreur lors de la d\xe9connexion:",a),i("Erreur lors de la d\xe9connexion: "+a.message)}},children:"Se d\xe9connecter"})]}):Object(v.jsx)("div",{children:"Utilisateur non trouv\xe9"})};var M=function(e){let{options:t,value:r,onChange:n,placeholder:a}=e;const[i,c]=Object(s.useState)(!1),o=Object(s.useRef)(null);Object(s.useEffect)((()=>{function e(e){o.current&&!o.current.contains(e.target)&&c(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]);const l=()=>Object.values(r).filter(Boolean).length;return Object(v.jsxs)("div",{className:"multiselect",ref:o,children:[Object(v.jsxs)("div",{className:"multiselect-header",onClick:()=>{c(!i)},children:[Object(v.jsx)("span",{children:0===l()?a:`${l()} s\xe9lectionn\xe9${l()>1?"s":""}`}),Object(v.jsx)("span",{className:"arrow "+(i?"up":"down")})]}),i&&Object(v.jsxs)("div",{className:"multiselect-dropdown",children:[Object(v.jsxs)("div",{className:"select-all",onClick:()=>{const e=t.every((e=>r[e.id])),s={};t.forEach((t=>{s[t.id]=!e})),n(s)},children:[Object(v.jsx)("input",{type:"checkbox",checked:t.every((e=>r[e.id])),readOnly:!0}),Object(v.jsx)("span",{children:"Tout s\xe9lectionner"})]}),t.map((e=>Object(v.jsxs)("div",{className:"multiselect-option",onClick:()=>(e=>{const t={...r,[e]:!r[e]};n(t)})(e.id),children:[Object(v.jsx)("input",{type:"checkbox",checked:r[e.id]||!1,readOnly:!0}),Object(v.jsx)("span",{children:e.label})]},e.id)))]})]})};const P=[{id:"QUART_1",label:"1er QUART (1h - 7h)",medecins:2},{id:"QUART_2",label:"2\xe8me QUART (7h - 13h)",medecins:3},{id:"RENFORT_1",label:"RENFORT 10h / 13h",medecins:1,samediOnly:!0},{id:"QUART_3",label:"3\xe8me QUART (13h - 19h)",medecins:3},{id:"RENFORT_2",label:"RENFORT 20H / 00H",medecins:1},{id:"QUART_4",label:"4\xe8me QUART (19h - 1h)",medecins:3}],I=[{id:"0",label:"Dimanche"},{id:"1",label:"Lundi"},{id:"2",label:"Mardi"},{id:"3",label:"Mercredi"},{id:"4",label:"Jeudi"},{id:"5",label:"Vendredi"},{id:"6",label:"Samedi"}],_=["Oui","Non","Possible"],$=["2024-01-01","2024-04-01","2024-05-01","2024-05-08","2024-05-09","2024-05-20","2024-07-14","2024-08-15","2024-11-01","2024-11-11","2024-12-25"];var Q=function(){const[e,t]=Object(s.useState)(null),[r,n]=Object(s.useState)({}),[a,i]=Object(s.useState)(0),[l,u]=Object(s.useState)(3),[j,O]=Object(s.useState)(!1),[m,x]=Object(s.useState)(!1),[g,D]=Object(s.useState)(null),[w,S]=Object(s.useState)(!0),[E,N]=Object(s.useState)(null),[U,A]=Object(s.useState)(null),[C,k]=Object(s.useState)(!1),[F,G]=Object(s.useState)({}),[Q,q]=Object(s.useState)({}),[L,V]=Object(s.useState)(""),[z,H]=Object(s.useState)(""),[J,B]=Object(s.useState)(""),[Y,W]=Object(s.useState)(!1),[X,K]=Object(s.useState)(""),[Z,ee]=Object(s.useState)(""),[te,re]=Object(s.useState)(""),[se,ne]=Object(s.useState)(""),ae=Object(o.f)(),ie=Object(s.useCallback)((()=>{if(!e)return[];const t=[];let r=new Date(e.startDate);const s=new Date(e.endDate);for(;r<=s;)t.push(new Date(r)),r.setDate(r.getDate()+1);return t}),[e]);Object(s.useEffect)((()=>{(async()=>{try{const e=h.currentUser;if(!e)return void ae.push("/");const r=await p(e.uid);if(r&&"medecin"===r.role){D(r);const e=await R();if(e){t(e);const s=(await T(r.id)).find((t=>new Date(t.startDate)<=new Date(e.endDate)&&new Date(t.endDate)>=new Date(e.startDate)));s&&(A(s.id),n(s.desiderata||{}),i(s.nombreGardesSouhaitees||0),u(s.nombreGardesMaxParSemaine||3),O(s.gardesGroupees||!1),x(s.renfortsAssocies||!1))}else N("Aucune p\xe9riode de saisie n'a \xe9t\xe9 d\xe9finie par l'administrateur.")}else N("Utilisateur non autoris\xe9"),ae.push("/")}catch(E){console.error("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es:",E),N("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es: "+E.message)}finally{S(!1)}})()}),[ae]);const ce=e=>`${["dim.","lun.","mar.","mer.","jeu.","ven.","sam."][e.getDay()]} ${e.getDate().toString().padStart(2,"0")} ${["jan","f\xe9v","mar","avr","mai","juin","juil","ao\xfbt","sep","oct","nov","d\xe9c"][e.getMonth()]}`;if(w)return Object(v.jsx)("div",{className:"loading",children:"Chargement..."});if(E)return Object(v.jsxs)("div",{className:"error-message",children:["Erreur: ",E]});if(!g||!e)return Object(v.jsx)("div",{className:"error-message",children:"Utilisateur non trouv\xe9 ou p\xe9riode de saisie non d\xe9finie"});const oe=ie();return Object(v.jsxs)("div",{className:"formulaire-container",children:[Object(v.jsx)("h1",{className:"page-title",children:"Formulaire de Desiderata"}),Object(v.jsx)(c.b,{to:"/dashboard-medecin",className:"back-link",children:"Retour au tableau de bord"}),Object(v.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),g)try{if(!e||!e.startDate||!e.endDate)throw new Error("P\xe9riode de saisie non d\xe9finie");const t={startDate:e.startDate,endDate:e.endDate,desiderata:r,nombreGardesSouhaitees:a,nombreGardesMaxParSemaine:l,gardesGroupees:j,renfortsAssocies:m};U?(await(async(e,t)=>{try{const r=Object(d.e)(b,f,e);await Object(d.m)(r,{startDate:y(t.startDate),endDate:y(t.endDate),desiderata:t.desiderata,nombreGardesSouhaitees:t.nombreGardesSouhaitees,nombreGardesMaxParSemaine:t.nombreGardesMaxParSemaine,gardesGroupees:t.gardesGroupees,renfortsAssocies:t.renfortsAssocies}),console.log("Desiderata mis \xe0 jour avec succ\xe8s")}catch(E){throw console.error("Erreur lors de la mise \xe0 jour des desiderata:",E),E}})(U,t),alert("Desiderata mis \xe0 jour avec succ\xe8s!")):(await(async(e,t)=>{try{if(!h.currentUser)throw new Error("Utilisateur non authentifi\xe9");return(await Object(d.b)(Object(d.c)(b,f),{userId:e,startDate:y(t.startDate),endDate:y(t.endDate),desiderata:t.desiderata,nombreGardesSouhaitees:t.nombreGardesSouhaitees,nombreGardesMaxParSemaine:t.nombreGardesMaxParSemaine,gardesGroupees:t.gardesGroupees,renfortsAssocies:t.renfortsAssocies})).id}catch(E){throw console.error("Erreur lors de l'ajout des desiderata:",E),E}})(g.id,t),alert("Desiderata soumis avec succ\xe8s!")),ae.push("/dashboard-medecin")}catch(E){console.error("Erreur lors de la soumission des desiderata:",E),N("Une erreur est survenue lors de la soumission des desiderata: "+E.message)}},className:"desiderata-form",children:[Object(v.jsxs)("h2",{className:"section-title",children:["P\xe9riode de saisie: du ",new Date(e.startDate).toLocaleDateString(),"au ",new Date(e.endDate).toLocaleDateString()]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"nombreGardes",children:"Nombre de gardes souhait\xe9es par mois:"}),Object(v.jsx)("input",{type:"number",id:"nombreGardes",value:a,onChange:e=>i(parseInt(e.target.value)),min:"0",required:!0})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"nombreGardesMaxParSemaine",children:"Nombre maximum de gardes par semaine:"}),Object(v.jsx)("input",{type:"number",id:"nombreGardesMaxParSemaine",value:l,onChange:e=>u(parseInt(e.target.value)),min:"1",max:"7",required:!0})]}),Object(v.jsxs)("div",{className:"option-group",children:[Object(v.jsxs)("label",{className:"switch",children:[Object(v.jsx)("input",{type:"checkbox",checked:j,onChange:e=>O(e.target.checked)}),Object(v.jsx)("span",{className:"slider"})]}),Object(v.jsx)("span",{children:"Gardes group\xe9es dans un m\xeame week-end"})]}),Object(v.jsxs)("div",{className:"option-group",children:[Object(v.jsxs)("label",{className:"switch",children:[Object(v.jsx)("input",{type:"checkbox",checked:m,onChange:e=>x(e.target.checked)}),Object(v.jsx)("span",{className:"slider"})]}),Object(v.jsx)("span",{children:"Renforts associ\xe9s \xe0 une garde"})]}),Object(v.jsxs)("div",{className:"quick-fill-section",children:[Object(v.jsx)("button",{type:"button",className:"toggle-quick-fill",onClick:()=>k(!C),children:C?"\u25bc Masquer le remplissage rapide":"\u25b6 Afficher le remplissage rapide"}),Object(v.jsxs)("div",{className:"quick-fill-module "+(C?"visible":""),children:[Object(v.jsx)("div",{className:"date-range-container",children:Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{children:"P\xe9riode de remplissage:"}),Object(v.jsxs)("div",{className:"date-inputs",children:[Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"quickFillStartDate",children:"Du:"}),Object(v.jsx)("input",{type:"date",id:"quickFillStartDate",value:z,onChange:e=>H(e.target.value),min:null===e||void 0===e?void 0:e.startDate.split("T")[0],max:null===e||void 0===e?void 0:e.endDate.split("T")[0]})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"quickFillEndDate",children:"Au:"}),Object(v.jsx)("input",{type:"date",id:"quickFillEndDate",value:J,onChange:e=>B(e.target.value),min:null===e||void 0===e?void 0:e.startDate.split("T")[0],max:null===e||void 0===e?void 0:e.endDate.split("T")[0]})]}),Object(v.jsx)("button",{type:"button",className:"select-full-period",onClick:()=>{e&&(H(new Date(e.startDate).toISOString().split("T")[0]),B(new Date(e.endDate).toISOString().split("T")[0]))},children:"Toute la p\xe9riode"})]})]})}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{children:"Cr\xe9neaux:"}),Object(v.jsx)(M,{options:P,value:F,onChange:G,placeholder:"S\xe9lectionnez les cr\xe9neaux"})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{children:"Jours de la semaine:"}),Object(v.jsx)(M,{options:I,value:Q,onChange:q,placeholder:"S\xe9lectionnez les jours"})]}),Object(v.jsxs)("div",{className:"form-group",children:[Object(v.jsx)("label",{htmlFor:"selectedDispo",children:"Disponibilit\xe9:"}),Object(v.jsxs)("select",{id:"selectedDispo",value:L,onChange:e=>V(e.target.value),children:[Object(v.jsx)("option",{value:"",children:"S\xe9lectionnez une disponibilit\xe9"}),_.map((e=>Object(v.jsx)("option",{value:e,children:e},e)))]})]}),Object(v.jsx)("button",{type:"button",onClick:()=>{if(!L)return void alert("Veuillez s\xe9lectionner une disponibilit\xe9.");if(!z||!J)return void alert("Veuillez s\xe9lectionner une p\xe9riode pour le remplissage rapide.");const e=Object.entries(F).filter((e=>{let[t,r]=e;return r})).map((e=>{let[t]=e;return t})),t=Object.entries(Q).filter((e=>{let[t,r]=e;return r})).map((e=>{let[t]=e;return t}));if(0===e.length)return void alert("Veuillez s\xe9lectionner au moins un cr\xe9neau.");if(0===t.length)return void alert("Veuillez s\xe9lectionner au moins un jour.");const r=new Date(z),s=new Date(J);r>s?alert("La date de d\xe9but doit \xeatre ant\xe9rieure \xe0 la date de fin."):(n((n=>{const a={...n};return ie().filter((e=>e>=r&&e<=s)).forEach((r=>{if(t.includes(r.getDay().toString())){const t=r.toISOString().split("T")[0];a[t]||(a[t]={}),e.forEach((e=>{"RENFORT_1"===e&&6!==r.getDay()||(a[t][e]=L)}))}})),a})),alert("Les cr\xe9neaux ont \xe9t\xe9 remplis avec succ\xe8s !"))},className:"fill-button",children:"Remplir les cr\xe9neaux s\xe9lectionn\xe9s"})]})]}),Object(v.jsxs)("div",{className:"copy-week-section",children:[Object(v.jsx)("button",{type:"button",className:"toggle-copy-week",onClick:()=>W(!Y),children:Y?"\u25bc Masquer la copie de semaine":"\u25b6 Afficher la copie de semaine"}),Object(v.jsxs)("div",{className:"copy-week-module "+(Y?"visible":""),children:[Object(v.jsxs)("div",{className:"date-range-container",children:[Object(v.jsxs)("div",{children:[Object(v.jsx)("h4",{children:"Semaine \xe0 copier :"}),Object(v.jsxs)("div",{className:"date-inputs",children:[Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"copyStartDate",children:"Du:"}),Object(v.jsx)("input",{type:"date",id:"copyStartDate",value:X,onChange:e=>K(e.target.value),min:null===e||void 0===e?void 0:e.startDate.split("T")[0],max:null===e||void 0===e?void 0:e.endDate.split("T")[0]})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"copyEndDate",children:"Au:"}),Object(v.jsx)("input",{type:"date",id:"copyEndDate",value:Z,onChange:e=>ee(e.target.value),min:null===e||void 0===e?void 0:e.startDate.split("T")[0],max:null===e||void 0===e?void 0:e.endDate.split("T")[0]})]})]})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("h4",{children:"Appliquer sur la p\xe9riode :"}),Object(v.jsxs)("div",{className:"date-inputs",children:[Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"copyTargetStartDate",children:"Du:"}),Object(v.jsx)("input",{type:"date",id:"copyTargetStartDate",value:te,onChange:e=>re(e.target.value),min:null===e||void 0===e?void 0:e.startDate.split("T")[0],max:null===e||void 0===e?void 0:e.endDate.split("T")[0]})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"copyTargetEndDate",children:"Au:"}),Object(v.jsx)("input",{type:"date",id:"copyTargetEndDate",value:se,onChange:e=>ne(e.target.value),min:null===e||void 0===e?void 0:e.startDate.split("T")[0],max:null===e||void 0===e?void 0:e.endDate.split("T")[0]})]})]})]})]}),Object(v.jsx)("button",{type:"button",onClick:()=>{if(!X||!Z||!te||!se)return void alert("Veuillez s\xe9lectionner toutes les dates n\xe9cessaires.");const e=new Date(X),t=new Date(Z),r=new Date(te),s=new Date(se);e>t||r>s?alert("Les dates de d\xe9but doivent \xeatre ant\xe9rieures aux dates de fin."):(n((n=>{const a={...n},i={};for(let r=new Date(e);r<=t;r.setDate(r.getDate()+1)){const e=r.toISOString().split("T")[0];n[e]&&(i[r.getDay()]=n[e])}let c=new Date(r);for(;c<=s;){const e=i[c.getDay()];if(e){a[c.toISOString().split("T")[0]]={...e}}c.setDate(c.getDate()+1)}return a})),alert("Le pattern a \xe9t\xe9 copi\xe9 avec succ\xe8s !"))},className:"copy-button",children:"Copier le pattern"})]})]}),Object(v.jsx)("div",{className:"table-container",children:Object(v.jsxs)("table",{children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:"Date"}),P.map((e=>Object(v.jsx)("th",{children:e.label},e.id)))]})}),Object(v.jsx)("tbody",{children:oe.map((e=>{const t=(e=>{const t=e.getDay(),r=e.toISOString().split("T")[0];return 0===t||6===t||$.includes(r)})(e),s=e.toISOString().split("T")[0];return Object(v.jsxs)("tr",{className:t?"highlighted":"",children:[Object(v.jsx)("td",{children:ce(e)}),P.map((t=>{var a;return Object(v.jsx)("td",{children:(!t.samediOnly||6===e.getDay())&&Object(v.jsxs)("select",{value:(null===(a=r[s])||void 0===a?void 0:a[t.id])||"",onChange:e=>((e,t,r)=>{n((s=>({...s,[e]:{...s[e]||{},[t]:r}})))})(s,t.id,e.target.value),children:[Object(v.jsx)("option",{value:"",children:"S\xe9lectionnez"}),_.map((e=>Object(v.jsx)("option",{value:e,children:e},e)))]})},`${s}-${t.id}`)}))]},s)}))})]})}),Object(v.jsx)("button",{type:"submit",className:"submit-button",children:U?"Mettre \xe0 jour les desiderata":"Soumettre les desiderata"})]})]})};var q=function(){const[e,t]=Object(s.useState)([]),[r,n]=Object(s.useState)({nom:"",prenom:"",email:"",role:"medecin",password:""}),[a,i]=Object(s.useState)(null),[l,j]=Object(s.useState)(!0),[x,g]=Object(s.useState)(null),f=Object(o.f)();Object(s.useEffect)((()=>{const e=h.onAuthStateChanged((async e=>{if(e)try{const t=await p(e.uid);"admin"!==t.role?(g("Acc\xe8s non autoris\xe9"),f.push("/")):(i(t),D())}catch(x){console.error("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es utilisateur:",x),g("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es utilisateur: "+x.message)}else f.push("/");j(!1)}));return()=>e()}),[f]);const D=async()=>{try{const e=await m();t(e)}catch(x){console.error("Erreur lors de la r\xe9cup\xe9ration des utilisateurs:",x),g("Erreur lors de la r\xe9cup\xe9ration des utilisateurs: "+x.message)}},w=e=>{const{name:t,value:r}=e.target;n((e=>({...e,[t]:r})))},y=async e=>{if(window.confirm("\xcates-vous s\xfbr de vouloir supprimer cet utilisateur ?"))try{await(async e=>{try{await Object(d.d)(Object(d.e)(b,O,e)),console.log("Utilisateur supprim\xe9 avec succ\xe8s")}catch(x){throw console.error("Erreur lors de la suppression de l'utilisateur:",x),x}})(e),alert("Utilisateur supprim\xe9 avec succ\xe8s!"),D()}catch(x){console.error("Erreur lors de la suppression de l'utilisateur:",x),g("Une erreur est survenue lors de la suppression de l'utilisateur: "+x.message)}};return l?Object(v.jsx)("div",{children:"Chargement..."}):x?Object(v.jsxs)("div",{children:["Erreur: ",x]}):a?Object(v.jsxs)("div",{className:"gestion-utilisateurs-container",children:[Object(v.jsx)("h1",{children:"Gestion des Utilisateurs"}),Object(v.jsx)(c.b,{to:"/dashboard-admin",children:"Retour au tableau de bord"}),Object(v.jsx)("h2",{children:"Ajouter un nouvel utilisateur"}),Object(v.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{await(async(e,t)=>{try{const r=await Object(u.a)(h,e,t);return console.log("Utilisateur enregistr\xe9:",r),r}catch(x){throw console.error("Erreur lors de l'enregistrement:",x),x}})(r.email,r.password,(r.nom,r.prenom,r.role)),alert("Utilisateur ajout\xe9 avec succ\xe8s!"),n({nom:"",prenom:"",email:"",role:"medecin",password:""}),D()}catch(x){console.error("Erreur lors de l'ajout de l'utilisateur:",x),g("Une erreur est survenue lors de l'ajout de l'utilisateur: "+x.message)}},children:[Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"nom",children:"Nom:"}),Object(v.jsx)("input",{type:"text",id:"nom",name:"nom",value:r.nom,onChange:w,required:!0})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"prenom",children:"Pr\xe9nom:"}),Object(v.jsx)("input",{type:"text",id:"prenom",name:"prenom",value:r.prenom,onChange:w,required:!0})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"email",children:"Email:"}),Object(v.jsx)("input",{type:"email",id:"email",name:"email",value:r.email,onChange:w,required:!0})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"password",children:"Mot de passe:"}),Object(v.jsx)("input",{type:"password",id:"password",name:"password",value:r.password,onChange:w,required:!0})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"role",children:"R\xf4le:"}),Object(v.jsxs)("select",{id:"role",name:"role",value:r.role,onChange:w,children:[Object(v.jsx)("option",{value:"medecin",children:"M\xe9decin"}),Object(v.jsx)("option",{value:"admin",children:"Administrateur"})]})]}),Object(v.jsx)("button",{type:"submit",children:"Ajouter l'utilisateur"})]}),Object(v.jsx)("h2",{children:"Liste des utilisateurs"}),Object(v.jsxs)("table",{children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:"Nom"}),Object(v.jsx)("th",{children:"Pr\xe9nom"}),Object(v.jsx)("th",{children:"Email"}),Object(v.jsx)("th",{children:"R\xf4le"}),Object(v.jsx)("th",{children:"Actions"})]})}),Object(v.jsx)("tbody",{children:e.map((e=>Object(v.jsxs)("tr",{children:[Object(v.jsx)("td",{children:e.nom}),Object(v.jsx)("td",{children:e.prenom}),Object(v.jsx)("td",{children:e.email}),Object(v.jsx)("td",{children:e.role}),Object(v.jsx)("td",{children:Object(v.jsx)("button",{onClick:()=>y(e.id),children:"Supprimer"})})]},e.id)))})]})]}):Object(v.jsx)("div",{children:"Utilisateur non autoris\xe9"})};const L=[{id:"QUART_1",label:"1er QUART (1h - 7h)",medecins:2},{id:"QUART_2",label:"2\xe8me QUART (7h - 13h)",medecins:3},{id:"RENFORT_1",label:"RENFORT 10h / 13h",medecins:1,samediOnly:!0},{id:"QUART_3",label:"3\xe8me QUART (13h - 19h)",medecins:3},{id:"RENFORT_2",label:"RENFORT 20H / 00H",medecins:1},{id:"QUART_4",label:"4\xe8me QUART (19h - 1h)",medecins:3}],V={QUART_2:["RENFORT_1"],RENFORT_1:["QUART_2"],QUART_4:["RENFORT_2"],RENFORT_2:["QUART_4"]},z=(e,t,r,s)=>{if(!V[r])return!1;const n=s[t];return V[r].some((t=>{var r;return null===(r=n[t])||void 0===r?void 0:r.includes(e)}))},H=(e,t,r,s)=>{const n={};let a=new Date(e);const i=new Date(t);for(;a<=i;){const e=a.toISOString().split("T")[0];n[e]={};["QUART_1","QUART_2","RENFORT_1","QUART_3","QUART_4","RENFORT_2"].forEach((t=>{const i=L.find((e=>e.id===t));!i||i.samediOnly&&6!==a.getDay()||(n[e][t]=Y(e,i,r,s,n))})),a.setDate(a.getDate()+1)}return n},J=e=>{const t=new Date(e);t.setHours(0,0,0,0),t.setDate(t.getDate()+4-(t.getDay()||7));const r=new Date(t.getFullYear(),0,1);return Math.ceil(((t-r)/864e5+1)/7)},B=(e,t,r)=>{const s=J(t);let n=0;return Object.entries(r).forEach((t=>{let[r,a]=t;J(r)===s&&Object.values(a).forEach((t=>{t&&t.includes(e)&&n++}))})),n},Y=(e,t,r,s,n)=>{const a=s.filter((s=>{var a,i,c;const o=null===(a=r[s])||void 0===a||null===(i=a.preferences[e])||void 0===i?void 0:i[t.id],l=B(s,e,n),d=(null===(c=r[s])||void 0===c?void 0:c.nombreGardesMaxParSemaine)||7,u=z(s,e,t.id,n);return("Oui"===o||"Possible"===o)&&l<d&&!u})).sort(((s,n)=>{var a,i,c,o;const l=null===(a=r[s])||void 0===a||null===(i=a.preferences[e])||void 0===i?void 0:i[t.id],d=null===(c=r[n])||void 0===c||null===(o=c.preferences[e])||void 0===o?void 0:o[t.id];return"Oui"===l&&"Oui"!==d?-1:"Oui"===d&&"Oui"!==l?1:0})),i=[];for(let c=0;c<t.medecins;c++)if(a.length>0){const s=W(a,e,t,r,n);s?(i.push(s),a.splice(a.indexOf(s),1)):i.push(null)}else i.push(null);return i},W=(e,t,r,s,n)=>{const a=new Date(t).getMonth();return e.sort(((e,i)=>{const c=X(e,t,r,s,n,a);return X(i,t,r,s,n,a)-c}))[0]},X=(e,t,r,s,n,a)=>{var i,c,o;let l=0;const d=s[e],u=B(e,t,n),j=(null===d||void 0===d?void 0:d.nombreGardesMaxParSemaine)||7;z(e,t,r.id,n)&&(l-=50),u>=j-1&&(l-=10),"Oui"===(null===(i=d.preferences[t])||void 0===i?void 0:i[r.id])?l+=3:"Possible"===(null===(c=d.preferences[t])||void 0===c?void 0:c[r.id])?l+=1:"Non"===(null===(o=d.preferences[t])||void 0===o?void 0:o[r.id])&&(l-=5);const b=K(e,n,a);return b<d.nombreGardesSouhaitees?l+=2:l-=2*(b-d.nombreGardesSouhaitees),d.gardesGroupees&&Z(t)&&ee(e,t,n)&&(l+=2),d.renfortsAssocies&&(r.id.startsWith("RENFORT")&&te(e,t,n)&&(l+=2),!r.id.startsWith("RENFORT")&&re(e,t,n)&&(l+=2)),l},K=(e,t,r)=>Object.entries(t).reduce(((t,s)=>{let[n,a]=s;return new Date(n).getMonth()===r?t+Object.values(a).flat().filter((t=>t===e)).length:t}),0),Z=e=>{const t=new Date(e).getDay();return 0===t||6===t},ee=(e,t,r)=>{const s=new Date(t),n=new Date(s.setDate(s.getDate()-s.getDay())),a=new Date(s.setDate(s.getDate()-s.getDay()+6));for(let i=new Date(n);i<=a;i.setDate(i.getDate()+1)){const t=i.toISOString().split("T")[0];if(r[t]&&Object.values(r[t]).flat().includes(e))return!0}return!1},te=(e,t,r)=>r[t]&&Object.values(r[t]).flat().includes(e),re=(e,t,r)=>{var s,n;return r[t]&&((null===(s=r[t].RENFORT_1)||void 0===s?void 0:s.includes(e))||(null===(n=r[t].RENFORT_2)||void 0===n?void 0:n.includes(e)))},se=function(e,t,r,s,n){let a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1e3,i=e,c=ae(e,s);const o=new Set;for(let l=0;l<a;l++){const e=ne(i,n,s);let t=null,r=-1/0;for(const n of e){const e=ae(n,s);e>r&&!o.has(JSON.stringify(n))&&(t=n,r=e)}r>c&&(i=t,c=r,o.add(JSON.stringify(t)),o.size>50&&o.delete(o.values().next().value))}return i},ne=(e,t,r)=>{const s=[],n=Object.keys(e),a=n[Math.floor(Math.random()*n.length)],i=Object.keys(e[a])[Math.floor(Math.random()*Object.keys(e[a]).length)],c=Math.floor(Math.random()*e[a][i].length);for(const d of t)if(!e[a][i].includes(d)){var o;const t=JSON.parse(JSON.stringify(e));t[a][i][c]=d;const n=B(d,a,t),l=(null===(o=r[d])||void 0===o?void 0:o.nombreGardesMaxParSemaine)||7,u=z(d,a,i,t);n<=l&&!u&&ie(t)&&s.push(t)}const l=JSON.parse(JSON.stringify(e));return l[a][i][c]=null,ie(l)&&s.push(l),s},ae=(e,t)=>{let r=0;const s={},n={};for(const u in e)for(const d in e[u])for(const j of e[u][d]){var a,i,c,o,l;if(null===j)continue;const b=J(u);n[j]||(n[j]={}),n[j][b]||(n[j][b]=0),n[j][b]++;const h=(null===(a=t[j])||void 0===a?void 0:a.nombreGardesMaxParSemaine)||7;n[j][b]>h&&(r-=20),z(j,u,d,e)&&(r-=50),s[j]||(s[j]=0),s[j]++;const O=null===(i=t[j])||void 0===i||null===(c=i.preferences[u])||void 0===c?void 0:c[d];"Oui"===O?r+=3:"Possible"===O?r+=1:"Non"===O&&(r-=5),null!==(o=t[j])&&void 0!==o&&o.gardesGroupees&&Z(u)&&ee(j,u,e)&&(r+=2),null!==(l=t[j])&&void 0!==l&&l.renfortsAssocies&&(d.startsWith("RENFORT")&&te(j,u,e)&&(r+=2),!d.startsWith("RENFORT")&&re(j,u,e)&&(r+=2))}for(const u in s){var d;r-=2*Math.abs(s[u]-(null===(d=t[u])||void 0===d?void 0:d.nombreGardesSouhaitees))}return r},ie=e=>{const t=Object.keys(e).sort(),r={};for(let s=0;s<t.length;s++){const n=t[s],a=new Set;for(const t in e[n]){const r=e[n][t];for(const s of r)if(null!==s){if(z(s,n,t,e))return!1;a.add(s)}}for(const i of a){if(s>=2){const r=new Set,n=new Set;if(Object.values(e[t[s-1]]).forEach((e=>{e.forEach((e=>{null!==e&&r.add(e)}))})),Object.values(e[t[s-2]]).forEach((e=>{e.forEach((e=>{null!==e&&n.add(e)}))})),r.has(i)&&n.has(i))return!1}const a=J(n);r[i]||(r[i]={}),r[i][a]||(r[i][a]=0),r[i][a]++}}for(const s in r)for(const e in r[s]){const t=7;if(r[s][e]>t)return!1}return!0};var ce=r(35);var oe=function(e){let{isAdmin:t=!1}=e;const[r,n]=Object(s.useState)(null),[a,i]=Object(s.useState)(null),[l,u]=Object(s.useState)(null),[j,x]=Object(s.useState)(!1),[g,f]=Object(s.useState)(!1),[w,E]=Object(s.useState)(null),[N,T]=Object(s.useState)([]),[k,F]=Object(s.useState)({}),[G,M]=Object(s.useState)(!0),[P,I]=Object(s.useState)(null),[_,$]=Object(s.useState)("all"),[Q,q]=Object(s.useState)(!1),[V,z]=Object(s.useState)(null),J=Object(o.f)();Object(s.useEffect)((()=>{(async()=>{try{const e=h.currentUser;if(!e)return void J.push("/");const r=await p(e.uid);if(!t&&"medecin"!==r.role)return I("Acc\xe8s non autoris\xe9"),void J.push("/");if(t&&"admin"!==r.role)return I("Acc\xe8s non autoris\xe9"),void J.push("/");E(r);const s=await R();if(!s)return void I("Aucune p\xe9riode de saisie n'a \xe9t\xe9 d\xe9finie");n(s);const a=await(async()=>{try{if(!h.currentUser)throw new Error("Utilisateur non authentifi\xe9");const e=Object(d.k)(Object(d.c)(b,O),Object(d.n)("role","==","medecin"));return(await Object(d.g)(e)).docs.map((e=>({id:e.id,...e.data()})))}catch(P){throw console.error("Erreur lors de la r\xe9cup\xe9ration des m\xe9decins:",P),P}})();if(T(a),t){const e=await(async()=>{try{if(!h.currentUser)throw new Error("Utilisateur non authentifi\xe9");const e=Object(d.k)(Object(d.c)(b,D),Object(d.j)("startDate","desc"),Object(d.i)(1)),t=await Object(d.g)(e);if(t.empty)return null;const r=t.docs[0],s=r.data();return{id:r.id,...s,startDate:S(s.startDate),endDate:S(s.endDate)}}catch(P){throw console.error("Erreur lors de la r\xe9cup\xe9ration du dernier planning:",P),P}})();e&&i(e);const t=await C();u(t)}else{const e=await C();e?(i(e),u(e)):I("Aucun planning n'a \xe9t\xe9 publi\xe9")}const c=await U(s.startDate,s.endDate),o=B(c);F(o)}catch(P){console.error("Erreur lors du chargement des donn\xe9es:",P),I("Une erreur est survenue lors du chargement des donn\xe9es")}finally{M(!1)}})()}),[J,t]);const B=e=>{const t={};return e.forEach((e=>{t[e.userId]={},Object.entries(e.desiderata).forEach((r=>{let[s,n]=r;const a=new Date(s).toISOString().split("T")[0];t[e.userId][a]=n}))})),t},Y=(e,t,r)=>{var s,n;const a=new Date(t).toISOString().split("T")[0];switch(null===(s=k[e])||void 0===s||null===(n=s[a])||void 0===n?void 0:n[r]){case"Oui":return"bg-green-200";case"Possible":return"bg-yellow-200";case"Non":return"bg-red-200";default:return"bg-white"}},W=(e,t,r)=>{const s=new Date(t).toISOString().split("T")[0];return[...e].sort(((e,t)=>{var n,a,i,c;const o=(null===(n=k[e.id])||void 0===n||null===(a=n[s])||void 0===a?void 0:a[r])||"",l=(null===(i=k[t.id])||void 0===i||null===(c=i[s])||void 0===c?void 0:c[r])||"",d={Oui:0,Possible:1,"":2,Non:3};return d[o]-d[l]}))},X=e=>["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"][new Date(e).getDay()],K=e=>{const t=N.find((t=>t.id===e));return t?`${t.prenom} ${t.nom}`:"Non assign\xe9"},Z=e=>{switch(e){case"Oui":return"\u2713";case"Possible":return"?";case"Non":return"\u2717";default:return"-"}},ee=e=>{switch(e){case"Oui":return"text-green-600 font-bold";case"Possible":return"text-yellow-600 font-bold";case"Non":return"text-red-600 font-bold";default:return"text-gray-400"}};if(G)return Object(v.jsx)("div",{children:"Chargement..."});if(P)return Object(v.jsxs)("div",{children:["Erreur: ",P]});if(!w||!r)return Object(v.jsx)("div",{children:"Donn\xe9es non disponibles"});const te=a&&a.planning?Object.keys(a.planning).sort(((e,t)=>new Date(e)-new Date(t))):[];return Object(v.jsxs)("div",{className:"gestion-planning-container",children:[Object(v.jsx)("h1",{children:t?"Gestion du Planning":"Visualisation du Planning"}),Object(v.jsx)(c.b,{to:t?"/dashboard-admin":"/dashboard-medecin",children:"Retour au tableau de bord"}),Object(v.jsxs)("p",{children:["P\xe9riode de saisie: du ",new Date(r.startDate).toLocaleDateString()," au ",new Date(r.endDate).toLocaleDateString()]}),t&&Object(v.jsxs)("div",{className:"mb-4",children:[Object(v.jsx)("button",{onClick:async()=>{if(r&&r.startDate&&r.endDate)try{M(!0);const e=await(async(e,t)=>{try{const r=await U(e,t),s=(await m()).filter((e=>"medecin"===e.role)).map((e=>e.id)),n={};r.forEach((e=>{n[e.userId]||(n[e.userId]={preferences:{},nombreGardesSouhaitees:e.nombreGardesSouhaitees,nombreGardesMaxParSemaine:e.nombreGardesMaxParSemaine||7,gardesGroupees:e.gardesGroupees,renfortsAssocies:e.renfortsAssocies}),Object.entries(e.desiderata).forEach((t=>{let[r,s]=t;const a=new Date(r).toISOString().split("T")[0];n[e.userId].preferences[a]||(n[e.userId].preferences[a]={}),Object.assign(n[e.userId].preferences[a],s)}))}));let a=H(e,t,n,s);return a=se(a,e,t,n,s),a}catch(P){throw console.error("Erreur lors de la g\xe9n\xe9ration du planning:",P),P}})(r.startDate,r.endDate);if(a&&a.id){const t={...a,planning:e};await A(a.id,t),i(t)}else{const t=await(async e=>{try{if(!h.currentUser)throw new Error("Utilisateur non authentifi\xe9");return(await Object(d.b)(Object(d.c)(b,D),{...e,startDate:y(e.startDate),endDate:y(e.endDate)})).id}catch(P){throw console.error("Erreur lors de la sauvegarde du planning:",P),P}})({planning:e,startDate:r.startDate,endDate:r.endDate});i({id:t,planning:e})}f(!1),alert("Planning g\xe9n\xe9r\xe9 avec succ\xe8s!")}catch(P){console.error("Erreur lors de la g\xe9n\xe9ration du planning:",P),I("Erreur lors de la g\xe9n\xe9ration du planning")}finally{M(!1)}else I("La p\xe9riode de saisie n'est pas d\xe9finie")},className:"mr-2",children:a?"R\xe9g\xe9n\xe9rer le planning":"G\xe9n\xe9rer un nouveau planning"}),Object(v.jsx)("button",{onClick:()=>{x(!j)},className:"mr-2",children:j?"Terminer l'\xe9dition":"Modifier le planning"}),g&&Object(v.jsx)("button",{onClick:async()=>{try{await A(a.id,a),f(!1),alert("Planning sauvegard\xe9 avec succ\xe8s!")}catch(P){console.error("Erreur lors de la sauvegarde du planning:",P),I("Erreur lors de la sauvegarde du planning")}},className:"mr-2",children:"Sauvegarder les modifications"}),a&&Object(v.jsx)("button",{onClick:async()=>{try{await(async e=>{try{if(!h.currentUser)throw new Error("Utilisateur non authentifi\xe9");const t=Object(d.e)(b,D,e);await Object(d.m)(t,{publishedAt:d.a.now()})}catch(P){throw console.error("Erreur lors de la publication du planning:",P),P}})(a.id);const e=await C();u(e),l?alert("Planning mis \xe0 jour et publi\xe9 avec succ\xe8s!"):alert("Planning publi\xe9 avec succ\xe8s!")}catch(P){console.error("Erreur lors de la publication du planning:",P),I("Erreur lors de la publication du planning: "+P.message)}},className:"mr-2",children:l?"Mettre \xe0 jour et publier le planning":"Publier le planning"}),Object(v.jsx)("button",{onClick:()=>q(!0),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Voir les desiderata"})]}),!t&&Object(v.jsxs)("div",{className:"mb-4",children:[Object(v.jsx)("button",{onClick:()=>$("all"),className:"mr-2",children:"Voir tout le planning"}),Object(v.jsx)("button",{onClick:()=>$("personal"),className:"mr-2",children:"Voir mes gardes"}),Object(v.jsx)("button",{onClick:()=>{if(!a||!a.planning)return;const e=[];Object.keys(a.planning).sort(((e,t)=>new Date(e)-new Date(t))).forEach((t=>{L.forEach((r=>{a.planning[t][r.id]&&a.planning[t][r.id].forEach(((s,n)=>{if(s===w.id){const s=new Date(t),n=new Date(t);let a,i;switch(r.id){case"QUART_1":a=1,i=7;break;case"QUART_2":a=7,i=13;break;case"RENFORT_1":a=10,i=13;break;case"QUART_3":a=13,i=19;break;case"RENFORT_2":a=20,i=24;break;case"QUART_4":a=19,i=25}s.setHours(a,0,0),n.setHours(i,0,0),25===i&&(n.setDate(n.getDate()+1),n.setHours(1,0,0)),e.push({start:[s.getFullYear(),s.getMonth()+1,s.getDate(),s.getHours(),s.getMinutes()],end:[n.getFullYear(),n.getMonth()+1,n.getDate(),n.getHours(),n.getMinutes()],title:`Garde - ${r.label}`,description:`Garde m\xe9dicale - ${r.label}`,location:"H\xf4pital"})}}))}))})),Object(ce.createEvents)(e,((e,t)=>{if(e)return console.error(e),void alert("Une erreur est survenue lors de la cr\xe9ation du fichier ICS");const r=new Blob([t],{type:"text/calendar;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(r),s.download="gardes.ics",document.body.appendChild(s),s.click(),document.body.removeChild(s)}))},className:"mr-2",children:"Exporter mes gardes (ICS)"})]}),Q&&Object(v.jsx)("div",{className:"modal-overlay",children:Object(v.jsxs)("div",{className:"modal-content",children:[Object(v.jsxs)("div",{className:"modal-header",children:[Object(v.jsx)("h2",{children:"Visualisation des desiderata"}),Object(v.jsx)("button",{onClick:()=>q(!1),className:"close-button",children:"\xd7"})]}),Object(v.jsxs)("div",{className:"modal-body",children:[Object(v.jsxs)("select",{value:V||"",onChange:e=>z(e.target.value),className:"medecin-select",children:[Object(v.jsx)("option",{value:"",children:"Tous les m\xe9decins"}),N.map((e=>Object(v.jsxs)("option",{value:e.id,children:[e.prenom," ",e.nom]},e.id)))]}),Object(v.jsx)("div",{className:"table-container",children:Object(v.jsxs)("table",{children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:"Date"}),!V&&Object(v.jsx)("th",{children:"M\xe9decin"}),L.map((e=>Object(v.jsx)("th",{children:e.label},e.id)))]})}),Object(v.jsx)("tbody",{children:te.map((e=>(V?[N.find((e=>e.id===V))]:N).map((t=>Object(v.jsxs)("tr",{children:[Object(v.jsx)("td",{children:`${X(e)} ${new Date(e).toLocaleDateString()}`}),!V&&Object(v.jsx)("td",{children:`${t.prenom} ${t.nom}`}),L.map((r=>{var s,n;if("RENFORT_1"===r.id&&6!==new Date(e).getDay())return Object(v.jsx)("td",{className:"text-center",children:"-"},`${e}-${r.id}`);const a=null===(s=k[t.id])||void 0===s||null===(n=s[e])||void 0===n?void 0:n[r.id];return Object(v.jsx)("td",{className:`text-center ${ee(a)}`,children:Z(a)},`${e}-${r.id}`)}))]},`${e}-${t.id}`)))))})]})})]})]})}),a&&a.planning&&Object.keys(a.planning).length>0&&Object(v.jsxs)("table",{className:"planning-table",children:[Object(v.jsx)("thead",{children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{children:"Date"}),L.map((e=>Object(v.jsx)("th",{children:e.label},e.id)))]})}),Object(v.jsx)("tbody",{children:te.map((e=>Object(v.jsxs)("tr",{children:[Object(v.jsx)("td",{children:`${X(e)} ${new Date(e).toLocaleDateString()}`}),L.map((r=>Object(v.jsx)("td",{children:"RENFORT_1"!==r.id||6===new Date(e).getDay()?a.planning[e][r.id]&&a.planning[e][r.id].length>0?a.planning[e][r.id].map(((s,n)=>t||"personal"!==_||s===w.id?Object(v.jsx)("div",{children:t&&j?Object(v.jsxs)("select",{value:s||"",onChange:s=>((e,r,s,n)=>{t&&j&&(i((t=>{const a={...t};return a.planning[e]||(a.planning[e]={}),a.planning[e][r]||(a.planning[e][r]=[]),a.planning[e][r][s]=n||null,a})),f(!0))})(e,r.id,n,s.target.value),className:`w-full p-1 border border-gray-300 rounded ${Y(s,e,r.id)}`,children:[Object(v.jsx)("option",{value:"",children:"Non assign\xe9"}),W(N,e,r.id).map((t=>Object(v.jsx)("option",{value:t.id,className:Y(t.id,e,r.id),children:`${t.prenom} ${t.nom}`},t.id)))]}):K(s)},`${e}-${r.id}-${n}`):null)):"Non assign\xe9":"N/A"},`${e}-${r.id}`)))]},e)))})]})]})};var le=function(){const[e,t]=Object(s.useState)(""),[r,n]=Object(s.useState)(""),[a,i]=Object(s.useState)(null),[l,u]=Object(s.useState)(!0),[j,O]=Object(s.useState)(null),m=Object(o.f)();return Object(s.useEffect)((()=>{const e=h.onAuthStateChanged((async e=>{if(e)try{const r=await p(e.uid);if("admin"!==r.role)O("Acc\xe8s non autoris\xe9"),m.push("/");else{i(r);const e=await R();e&&(t(e.startDate.split("T")[0]),n(e.endDate.split("T")[0]))}}catch(j){console.error("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es utilisateur:",j),O("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es utilisateur")}else m.push("/");u(!1)}));return()=>e()}),[m]),l?Object(v.jsx)("div",{children:"Chargement..."}):j?Object(v.jsxs)("div",{children:["Erreur: ",j]}):a?Object(v.jsxs)("div",{className:"gestion-periode-saisie-container",children:[Object(v.jsx)("h1",{children:"Gestion de la p\xe9riode de saisie des desiderata"}),Object(v.jsx)(c.b,{to:"/dashboard-admin",children:"Retour au tableau de bord"}),Object(v.jsxs)("form",{onSubmit:async t=>{t.preventDefault();try{await(async(e,t)=>{try{if(!h.currentUser)throw new Error("Utilisateur non authentifi\xe9");await Object(d.l)(Object(d.e)(b,D,w),{startDate:y(e),endDate:y(t)}),await E(e,t),console.log("P\xe9riode de saisie mise \xe0 jour et desiderata obsol\xe8tes supprim\xe9s")}catch(j){throw console.error("Erreur lors de la mise \xe0 jour de la p\xe9riode de saisie:",j),j}})(e,r),alert("P\xe9riode de saisie mise \xe0 jour avec succ\xe8s! Les desiderata obsol\xe8tes ont \xe9t\xe9 supprim\xe9s.")}catch(j){console.error("Erreur lors de la mise \xe0 jour de la p\xe9riode de saisie:",j),O("Une erreur est survenue lors de la mise \xe0 jour de la p\xe9riode de saisie")}},children:[Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"startDate",children:"Date de d\xe9but:"}),Object(v.jsx)("input",{type:"date",id:"startDate",value:e,onChange:e=>t(e.target.value),required:!0})]}),Object(v.jsxs)("div",{children:[Object(v.jsx)("label",{htmlFor:"endDate",children:"Date de fin:"}),Object(v.jsx)("input",{type:"date",id:"endDate",value:r,onChange:e=>n(e.target.value),required:!0})]}),Object(v.jsx)("button",{type:"submit",children:"Mettre \xe0 jour la p\xe9riode de saisie"})]})]}):Object(v.jsx)("div",{children:"Utilisateur non autoris\xe9"})};var de=function(){return Object(v.jsx)(c.a,{children:Object(v.jsx)("div",{className:"App",children:Object(v.jsxs)(o.c,{children:[Object(v.jsx)(o.a,{exact:!0,path:"/",component:g}),Object(v.jsx)(o.a,{path:"/dashboard-medecin",component:F}),Object(v.jsx)(o.a,{path:"/dashboard-admin",component:G}),Object(v.jsx)(o.a,{path:"/formulaire-desirata",component:Q}),Object(v.jsx)(o.a,{path:"/gestion-utilisateurs",component:q}),Object(v.jsx)(o.a,{path:"/gestion-planning-admin",render:()=>Object(v.jsx)(oe,{isAdmin:!0})}),Object(v.jsx)(o.a,{path:"/visualisation-planning",render:()=>Object(v.jsx)(oe,{isAdmin:!1})}),Object(v.jsx)(o.a,{path:"/gestion-periode-saisie",component:le})]})})})};i.a.render(Object(v.jsx)(n.a.StrictMode,{children:Object(v.jsx)(de,{})}),document.getElementById("root"))}},[[68,1,2]]]);
//# sourceMappingURL=main.6d1cc62b.chunk.js.map